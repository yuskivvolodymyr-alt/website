<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - QubeNode</title>
    
    <!-- Dashboard Styles - CSP Compliant -->
    <link rel="stylesheet" href="styles-dashboard.css">
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-animation"></div>
    <div class="grid-overlay"></div>
    
    <div class="container">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="dashboard-header-flex">
                <h1 class="dashboard-title">üíé Your Staking Dashboard</h1>
                <a href="index.html" class="btn-home">üè† To Main</a>
            </div>
            <p class="wallet-address-text">Address: <span id="walletAddress" class="wallet-address-value">Loading...</span></p>
            <button id="disconnectWalletBtn" class="btn-disconnect">üö™ Disconnect Wallet</button>
        </div>
        
        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card stat-card-blue">
                <div class="stat-label">üí∞ BALANCE</div>
                <div class="stat-value stat-value-blue"><span id="balance">0.000</span> TICS</div>
            </div>
            <div class="stat-card stat-card-green">
                <div class="stat-label">üíé DELEGATED</div>
                <div class="stat-value stat-value-green"><span id="delegated">0.000</span> TICS</div>
            </div>
            <div class="stat-card stat-card-green">
                <div class="stat-label">‚ú® REWARDS</div>
                <div class="stat-value stat-value-green"><span id="rewards">0.000</span> TICS</div>
            </div>
            <div class="stat-card stat-card-red">
                <div class="stat-label">‚è≥ UNBONDING</div>
                <div class="stat-value stat-value-red"><span id="unbonding">0.000</span> TICS</div>
            </div>
        </div>
        
        <!-- Forecast -->
        <div class="section">
            <h4 class="section-title">üìä Rewards Forecast</h4>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Per day</div>
                    <div class="stat-value stat-value-light-green"><span id="forecastDaily">0.000</span> TICS</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Per week</div>
                    <div class="stat-value stat-value-light-green"><span id="forecastWeekly">0.000</span> TICS</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Per month</div>
                    <div class="stat-value stat-value-light-green"><span id="forecastMonthly">0.000</span> TICS</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Per year</div>
                    <div class="stat-value stat-value-light-green"><span id="forecastYearly">0.000</span> TICS</div>
                </div>
            </div>
            <p class="forecast-disclaimer">* APY ~30%, validator commission already included. Calculation provided without compound interest.</p>
        </div>
        
        <!-- Quick Actions -->
        <div class="section">
            <h4 class="section-title">üíé Quick Actions</h4>
            <div class="quick-actions">
                <button class="btn-quick btn-delegate">
                    Delegate to QubeNode
                </button>
                <button class="btn-quick btn-claim-all">
                    <div class="quick-claim-wrapper">
                        <span>Claim All Rewards</span>
                        <span class="quick-claim-label"><span id="quickClaimAmount">0.000</span> TICS</span>
                    </div>
                </button>
            </div>
        </div>
        
        <!-- My Delegations -->
        <div class="section">
            <h4 class="section-title">üìã My Delegations</h4>
            <div id="delegationsList">
                <div class="loading-text">Loading delegations...</div>
            </div>
        </div>
        
        <!-- Unbonding Delegations -->
        <div class="section section-hidden" id="unbondingSection">
            <h4 class="section-title section-title-red">‚è≥ Unbonding Delegations</h4>
            <div id="unbondingList"></div>
        </div>
    </div>
    
    <!-- MODALS -->
    
    <!-- Stake More / Delegate Modal -->
    <div id="stakeMoreModal" class="modal">
        <div class="modal-content modal-content-cyan">
            <div class="modal-header modal-header-compact">
                <h3 class="modal-title-cyan">
                    <span class="modal-title-icon">üíé</span>
                    <span>Delegate TICS</span>
                </h3>
                <span class="close" id="closeStakeMoreModal">&times;</span>
            </div>
            <div class="modal-body modal-body-compact">
                <div class="validator-info-box validator-info-box-compact">
                    <div class="validator-name-large" id="stakeMoreValidatorName"></div>
                    <div class="validator-addr-small" id="stakeMoreValidatorAddr"></div>
                </div>
                
                <div class="form-section">
                    <label class="form-label">Amount to delegate (TICS)</label>
                    <input type="number" id="stakeMoreAmount" placeholder="0.00" step="0.001">
                </div>
                
                <div class="amount-info-flex">
                    <span>Minimum: 0.1 TICS</span>
                    <span>Available: <span id="stakeMoreAvailable">0.000</span> TICS</span>
                </div>
                
                <div class="info-box-green">
                    <label class="checkbox-label">
                        <input type="checkbox" checked class="checkbox-input">
                        <span>You will start receiving rewards immediately after delegation</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer modal-footer-compact">
                <button class="btn-cancel" id="cancelStakeMore">Cancel</button>
                <button class="btn-confirm cyan" id="confirmStakeMore">Delegate</button>
            </div>
        </div>
    </div>
    
    <!-- Claim All Rewards Modal -->
    <div id="claimAllModal" class="modal">
        <div class="modal-content modal-content-yellow">
            <div class="modal-header">
                <h3 class="modal-title-yellow">üí∞ Claim Rewards</h3>
                <span class="close" id="closeClaimAllModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="total-rewards">
                    <div class="total-rewards-label">Total Rewards:</div>
                    <div class="total-rewards-amount"><span id="claimTotalAmount">0.0000</span> TICS</div>
                </div>
                
                <div class="section-label">Rewards from validators:</div>
                <div class="rewards-list" id="claimRewardsList"></div>
                
                <div class="info-box-green-large">
                    <label class="checkbox-label-medium">
                        <input type="checkbox" checked class="checkbox-input-medium">
                        <span>All rewards will be claimed in one transaction</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="cancelClaimAll">Cancel</button>
                <button class="btn-confirm green" id="confirmClaimAll">Claim</button>
            </div>
        </div>
    </div>
    
    <!-- Switch Validator Modal - Step 1 -->
    <div id="switchValidatorModal" class="modal">
        <div class="modal-content modal-content-cyan">
            <div class="modal-header modal-header-compact">
                <h3 class="modal-title-cyan">
                    <span class="modal-title-icon">üîÑ</span>
                    <span>Switch Validator</span>
                </h3>
                <span class="close" id="closeSwitchModal1">&times;</span>
            </div>
            <div class="modal-body modal-body-compact">
                <div class="form-section-medium">
                    <div class="section-label-from">From:</div>
                    <div class="validator-info-box validator-info-box-compact">
                        <div class="validator-name-large" id="switchFromValidatorName"></div>
                        <div class="validator-staked-info">Staked: <span id="switchFromStaked">0.0000</span> TICS</div>
                    </div>
                </div>
                
                <div class="section-label-small">Select Validator:</div>
                <div id="validatorsList" class="validators-list-scroll"></div>
            </div>
            <div class="modal-footer modal-footer-compact">
                <button class="btn-cancel" id="cancelSwitch1">Cancel</button>
                <button class="btn-confirm cyan" id="nextSwitch">Next</button>
            </div>
        </div>
    </div>
    
    <!-- Switch Validator Modal - Step 2 -->
    <div id="switchValidatorModal2" class="modal">
        <div class="modal-content modal-content-cyan">
            <div class="modal-header modal-header-compact">
                <h3 class="modal-title-cyan">
                    <span class="modal-title-icon">üîÑ</span>
                    <span>Switch Validator</span>
                </h3>
                <span class="close" id="closeSwitchModal2">&times;</span>
            </div>
            <div class="modal-body modal-body-compact">
                <div class="form-section">
                    <div class="section-label-from-small">From:</div>
                    <div class="validator-info-box validator-info-compact">
                        <div class="validator-name-medium" id="switchFromValidatorName2"></div>
                        <div class="validator-addr-with-margin" id="switchFromValidatorAddr2"></div>
                        <div class="validator-staked-info">Staked: <span id="switchFromStaked2">0.0000</span> TICS</div>
                    </div>
                </div>
                
                <div class="form-section">
                    <div class="section-label-from-small">To:</div>
                    <div class="validator-info-box validator-info-compact">
                        <div class="validator-name-medium" id="switchToValidatorName"></div>
                        <div class="validator-addr-tiny" id="switchToValidatorAddr"></div>
                    </div>
                </div>
                
                <div class="form-section-small">
                    <label class="form-label">Amount (TICS)</label>
                    <input type="number" id="switchAmount" placeholder="0.00" step="0.001">
                </div>
                
                <div class="amount-info-right">
                    Maximum: <span id="switchMaxAmount">0.0000</span> TICS
                </div>
            </div>
            <div class="modal-footer modal-footer-compact">
                <button class="btn-cancel" id="cancelSwitch2">Cancel</button>
                <button class="btn-confirm cyan" id="confirmSwitch">Switch</button>
            </div>
        </div>
    </div>
    
    <!-- Unbond Modal -->
    <div id="unbondModal" class="modal">
        <div class="modal-content modal-content-red">
            <div class="modal-header modal-header-compact">
                <h3 class="modal-title-red">
                    <span class="modal-title-icon">üîì</span>
                    <span>Unstake TICS</span>
                </h3>
                <span class="close" id="closeUnbondModal">&times;</span>
            </div>
            <div class="modal-body modal-body-compact">
                <div class="validator-info-box validator-info-box-compact" style="background: rgba(239,68,68,0.08); border-color: rgba(239,68,68,0.2);">
                    <div class="validator-name-large" style="color: #ef4444;" id="unbondValidatorName"></div>
                    <div class="validator-staked-info">Staked: <span id="unbondStaked">0.0000</span> TICS</div>
                </div>
                
                <div class="form-section">
                    <label class="form-label">Amount (TICS)</label>
                    <input type="number" id="unbondAmount" placeholder="0.00" step="0.001" style="border-color: rgba(239,68,68,0.3);">
                </div>
                
                <div class="amount-info-right">
                    Staked: <span id="unbondMaxAmount">0.0000</span> TICS
                </div>
                
                <div class="warning-box" style="padding: 10px 12px;">
                    <div class="warning-item" style="font-size: 11px; margin-bottom: 6px;">‚ö†Ô∏è You will NOT earn rewards during unbonding</div>
                    <div class="warning-item" style="font-size: 11px; margin-bottom: 6px;">‚ö†Ô∏è Tokens will be locked for 14 days</div>
                    <div class="warning-item" style="font-size: 11px; margin-bottom: 0;">‚ö†Ô∏è You can cancel unbonding before completion</div>
                </div>
            </div>
            <div class="modal-footer modal-footer-compact">
                <button class="btn-cancel" id="cancelUnbond">Cancel</button>
                <button class="btn-confirm red" id="confirmUnbond">Unstake</button>
            </div>
        </div>
    </div>
    
    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content" style="border-color: rgba(34,197,94,0.6); max-width: 600px;">
            <div class="modal-header" style="background: linear-gradient(135deg, rgba(34,197,94,0.2), rgba(34,197,94,0.05));">
                <h3 style="color: #22c55e;">‚úÖ Success! TX: <span id="successMessage"></span></h3>
                <span class="close" id="closeSuccessModal">&times;</span>
            </div>
            <div class="modal-body">
                <div style="background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.3); border-radius: 12px; padding: 20px; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 16px;">‚úÖ</div>
                    <div style="color: #86efac; font-size: 18px; font-weight: 600; margin-bottom: 12px;" id="successTitle">Transaction successful!</div>
                    <div style="color: #94a3b8; font-size: 14px; margin-bottom: 20px;">Transaction hash:</div>
                    <div style="background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px; word-break: break-all; font-family: monospace; font-size: 13px; color: #00FFF0;" id="successTxHash"></div>
                    <a id="successExplorerLink" href="#" target="_blank" style="display: inline-block; margin-top: 16px; padding: 10px 20px; background: linear-gradient(135deg, #00D4FF, #00FFF0); border-radius: 8px; color: #000; text-decoration: none; font-weight: 600;">üîç View in Explorer</a>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-confirm cyan" id="successOK" style="width: 100%;">OK</button>
            </div>
        </div>
    </div>

    <!-- Ethers.js for MetaMask Support -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>
    
    <!-- MetaMask Integration -->
    <script src="metamask-connector.js"></script>
    
    <!-- Cosmos Staking Modules -->
    <script src="chain-config.js?v=10"></script>
    <script src="wallet-manager.js?v=10"></script>
    <script src="chain-client.js?v=10"></script>
    <script src="transaction-builder.js?v=10"></script>
    <script src="staking-service.js?v=10"></script>
    <script src="cosmos-staking.js?v=10"></script>
    <script src="validators-registry.js?v=10"></script>
    
    <!-- Dashboard Initialization -->
    <script src="init-dashboard.js"></script>
</body>
</html>
